@{
    ViewBag.Title = "Create Transfer";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<script type="text/javascript">
    function Asset() {
        var Column = [
                    { "data": "0" },
                    { "title": "Asset Code", "data": "0" },
                    { "title": "Asset Name", "data": "1" },
                    { "title": "Serial No", "data": "2" }
        ]
        DTable("datatablepopup", '@Url.Action("GetPopupAssetTransfer", "Asset")', Column, '{}');
        $('#datatablepopup tbody').on('click', 'tr', function () {
            var d = table.row(this).data();
            $("#AssetCode").val(d[0]);
            $("#AssetName").val(d[1]);
            $("#AssetSerialNo").val(d[2]);
            $('#Lookup').modal('hide');
        });
    }

    function TypeTransfer() {
        var Column = [
                    { "data": "0" },
                    { "title": "Type", "data": "0" },
                    { "title": "Type Name", "data": "1" }
        ]
        DTable("datatablepopup", '@Url.Action("GetPopupTypeTransfer", "Asset")', Column, '{}');
        $('#datatablepopup tbody').on('click', 'tr', function () {
            var d = table.row(this).data();
            $("#Type").val(d[0]);
            $("#TypeName").val(d[1]);
            $('#Lookup').modal('hide');
        });
    }

    function TypeTransfer() {
        var Column = [
                    { "data": "0" },
                    { "title": "Type", "data": "0" },
                    { "title": "Type Name", "data": "1" }
        ]
        DTable("datatablepopup", '@Url.Action("GetPopupTypeTransfer", "Asset")', Column, '{}');
        $('#datatablepopup tbody').on('click', 'tr', function () {
            var d = table.row(this).data();
            $("#Type").val(d[0]);
            $("#TypeName").val(d[1]);
            $('#Lookup').modal('hide');

            if (d[0] == "RCP" )
                $('#btnRefTransfer').removeClass('disabled');
            else
                $('#btnRefTransfer').addClass('disabled');

            $("#TransferAsseNoRef").val('');
        });
    }

    function Site() {
        var Column = [
                    { "data": "0" },
                    { "title": "Site Code", "data": "0" },
                    { "title": "Site Name", "data": "1" },
                    { "title": "Address", "data": "2" },
                    { "title": "City", "data": "3" },
                    { "title": "PostalCode", "data": "4" }
        ]
        DTable("datatablepopup", '@Url.Action("GetPopupSite", "Asset")', Column, '{}');
        $('#datatablepopup tbody').on('click', 'tr', function () {
            var d = table.row(this).data();
            $("#SiteCode").val(d[0]);
            $("#SiteName").val(d[1]);
            $("#LocationCode").val("");
            $("#LocationName").val("");
            $("#Floor").val("");
            $('#Lookup').modal('hide');
        });
    }
    function Location() {
        var Column = [
                    { "data": "LocationCode" },
                    { "title": "Location Code", "data": "LocationCode" },
                    { "title": "Location Name", "data": "LocationName" },
                    { "title": "Site Name", "data": "SiteName" },
                    { "title": "Floor", "data": "Floor" }
        ]
        DTable("datatablepopup", '@Url.Action("GetPopupLocation", "Asset")', Column, function (d) { d.SiteCode = $('#SiteCode').val() });
        $('#datatablepopup tbody').on('click', 'tr', function () {
            var d = table.row(this).data();
            $("#LocationCode").val(d["LocationCode"]);
            $("#LocationName").val(d["LocationName"]);
            $("#Floor").val(d["Floor"]);
            $('#Lookup').modal('hide');
        });
    }

    function TransferNoRef() {
        var Column = [
                    { "data": "TransferAssetNo" },
                    { "title": "Transfer No", "data": "TransferAssetNo" },
                    { "title": "Status", "data": "NamaStatus" },
                    { "title": "Type", "data": "NamaType" },
                    { "title": "Site", "data": "SiteName" },
                    { "title": "Location", "data": "LocationName" },
                    { "title": "Floor", "data": "Floor" }
        ]
        DTable("datatablepopup", '@Url.Action("GetPopupTransferNoRef", "Asset")', Column, '{}');
        $('#datatablepopup tbody').on('click', 'tr', function () {
            var d = table.row(this).data();
            $("#TransferAssetNoRef").val(d["TransferAssetNo"]);
            $("#SiteCode").val(d["SiteCode"]);
            $("#SiteName").val(d["SiteName"]);
            $("#LocationCode").val(d["LocationCode"]);
            $("#LocationName").val(d["LocationName"]);
            $("#Floor").val(d["Floor"]);
            $('#Lookup').modal('hide');
        });
    }

    function AddAsset() {
        var AssetCode = document.getElementById("AssetCode").value;
        var AssetName = document.getElementById("AssetName").value;
        var AssetSerialNo = document.getElementById("AssetSerialNo").value;

        if (AssetCode == "") {
            $(".modal-body #peringatan3").text("Asset Code must be filled");
            $('#btnerror').click(function (e) {
                $('#Alert3').modal('hide');
            })
            $("#Alert3").modal();
        } else if (AssetName == "") {
            $(".modal-body #peringatan3").text("Asset Name must be filled");
            $('#btnerror').click(function (e) {
                $('#Alert3').modal('hide');
            })
            $("#Alert3").modal();
        } else if (AssetSerialNo == "") {
            $(".modal-body #peringatan3").text("Serial No must be filled");
            $('#btnerror').click(function (e) {
                $('#Alert3').modal('hide');
            })
            $("#Alert3").modal();
        }
        else {
            $.ajax({
                url: '@Url.Action("AddAssetTransfer", "Asset")',
                type: 'Post',
                cache: false,
                async: true,
                data: {
                    AssetCode: AssetCode,
                    AssetName: AssetName,
                    AssetSerialNo: AssetSerialNo
                },
                success: function (response) {
                    if (response.success == true) {
                        $(".modal-body #peringatan2").text(response.responseText);
                        $('#btnok').click(function (e) {
                            window.location.href = "@Url.Action("Createtransfer","Asset")";
                        })
                        $("#Alert2").modal();
                    } else {
                        $(".modal-body #peringatan3").text(response.responseText);
                        $('#btnerror').click(function (e) {
                            $('#Alert3').modal('hide');
                        })
                        $("#Alert3").modal();
                    }
                },
                error: function (XMLHttpRequest, textStatus, errorThrown) {
                    $(".modal-body #peringatan1").text("Please Wait...");
                    $('#btncaution').click(function (e) {
                        $('#Alert1').modal('hide');
                    })
                    $("#Alert1").modal();
                }
            });
        }
    }
    function DeleteAsset(AssetCode) {

        $(".modal-body #peringatan4").text("Anda You Sure Delete Asset Code " + AssetCode  + " ?");
        $('#btnyes').click(function (e) {
            $('#Alert4').modal('hide');
            $.ajax({
                url: '@Url.Action("DeleteAssetTransfer", "Asset")',
                type: 'Post',
                cache: false,
                async: true,
                data: {
                    AssetCode: AssetCode
                },
                success: function (response) {
                    if (response.success == true) {
                        $(".modal-body #peringatan2").text(response.responseText);
                        $('#btnok').click(function (e) {
                            window.location.href = "@Url.Action("Createtransfer", "Asset")";
                        })
                        $("#Alert2").modal();
                    } else {
                        $(".modal-body #peringatan3").text(response.responseText);
                        $('#btnerror').click(function (e) {
                            $('#Alert3').modal('hide');
                        })
                        $("#Alert3").modal();
                    }
                },
                error: function (XMLHttpRequest, textStatus, errorThrown) {
                    $(".modal-body #peringatan1").text("Mohon Tunggu...");
                    $('#btncaution').click(function (e) {
                        $('#Alert1').modal('hide');
                    })
                    $("#Alert1").modal();
                }
            });
        })
        $('#btnno').click(function (e) {
            $('#Alert4').modal('hide');
        })
        $("#Alert4").modal();
    }


    function Transfer() {

        var TransferNo = document.getElementById("TransferNo").value;
        var Type = document.getElementById("Type").value;
        var TransferDate = document.getElementById("single_cal2").value;
        var SiteCode = document.getElementById("SiteCode").value;
        var LocationCode = document.getElementById("LocationCode").value;
        var Floor = document.getElementById("Floor").value;
        var Notes = document.getElementById("Notes").value;

        if (Type == "SNT") {
            $("#TransferAssetNoRef").val("");
        } else {
           var TransferAssetNoRef = document.getElementById("TransferAssetNoRef").value;
        }

        if (Type == "") {
            $(".modal-body #peringatan3").text("Type To must be filled");
            $('#btnerror').click(function (e) {
                $('#Alert3').modal('hide');
            })
            $("#Alert3").modal();
        } else if (TransferDate == "") {
            $(".modal-body #peringatan3").text("Transfer Date must be filled");
            $('#btnerror').click(function (e) {
                $('#Alert3').modal('hide');
            })
            $("#Alert3").modal();
        } else if (SiteCode == "") {
            $(".modal-body #peringatan3").text("Site must be filled");
            $('#btnerror').click(function (e) {
                $('#Alert3').modal('hide');
            })
            $("#Alert3").modal();

        } else if (LocationCode == "") {
            $(".modal-body #peringatan3").text("Location must be filled");
            $('#btnerror').click(function (e) {
                $('#Alert3').modal('hide');
            })
            $("#Alert3").modal();
        } else if (Type == "RCP" && TransferAssetNoRef == "") {
            $(".modal-body #peringatan3").text("No Ref Transfer must be filled");
            $('#btnerror').click(function (e) {
                $('#Alert3').modal('hide');
            })
            $("#Alert3").modal();
        }
        else {
            $(".modal-body #peringatan4").text("Are You Sure Transfer Asset ?");
            $("#Alert4").modal();
            $('#btnyes').click(function (e) {
                $('#Alert4').modal('hide');
                $.ajax({
                    url: '@Url.Action("SaveTransfer", "Asset")',
                    type: 'Post',
                    cache: false,
                    async: true,
                    data: {
                        TransferNo: TransferNo,
                        Type: Type,
                        TransferDate: TransferDate,
                        TransferAssetNoRef: TransferAssetNoRef,
                        SiteCode: SiteCode,
                        LocationCode: LocationCode,
                        Floor: Floor,
                        Notes: Notes
                    },
                    success: function (response) {
                        if (response.success == true) {
                            $(".modal-body #peringatan2").text(response.responseText);
                            $('#btnok').click(function (e) {
                                window.location.href = "@Url.Action("Transfer","Asset")";
                            })
                            $("#Alert2").modal();
                        } else {
                            $(".modal-body #peringatan3").text(response.responseText);
                            $('#btnerror').click(function (e) {
                                $('#Alert3').modal('hide');
                            })
                            $("#Alert3").modal();
                        }
                    },
                    error: function (XMLHttpRequest, textStatus, errorThrown) {
                        $(".modal-body #peringatan1").text("Please Wait...");
                        $('#btncaution').click(function (e) {
                            $('#Alert1').modal('hide');
                        })
                        $("#Alert1").modal();
                    }
                });
            })
        }
        $('#btnno').click(function (e) {
            $('#Alert4').modal('hide');
        })
    }

</script>
<div class="right_col" role="main">
    <div class="">
        <div class="row">
            <div class="col-md-12 col-sm-12 col-xs-12">
                <div class="x_panel">
                    <div class="menusect">
                        <h5>
                            Assets •
                            <a href="/asset/transfer" class="activemenu">Transfer</a> •
                            <a href="/asset/createtransfer" class="activemenu">Create Transfer</a>
                        </h5>
                    </div>
                    <div class="x_title">
                        <h2>Create Transfer</h2>
                        <div class="clearfix"></div>
                    </div>
                    <div class="x_content">
                        <div class="text-muted font-13 m-b-30">
                            <div class="mgbtm20">
                                <button id="selectasset" type="button" class="btn btn-success">Select Asset</button>
                            </div>
                        </div>
                        <div class="form-group">
                            <h3 style="color: #c11118;border-bottom: 1px dashed;padding-bottom: 5px;">Assets Pending Transfer</h3>
                        </div>
                        <table id="datatable" class="table table-striped table-bordered bulk_action">
                            <thead>
                                <tr>
                                    <th width="12%">Asset Code</th>
                                    <th>Asset Name</th>
                                    <th width="9%">Serial No</th>
                                    <th style="width:9%;"></th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (CORE.JGC.Models.TrTransferAssetLine item in Model)
                                {
                                    <tr>
                                        <td>@Html.DisplayFor(modelItem => item.AssetCode)</td>
                                        <td>@Html.DisplayFor(modelItem => item.AssetName)</td>
                                        <td>@Html.DisplayFor(modelItem => item.AssetSerialNo)</td>
                                        <td style="width:5% !important;text-align:center;">
                                            <button id="delete" name="delete" type="button" data-toggle="tooltip" title="Delete" class="btn btn-success" onclick="return DeleteAsset('@Html.DisplayFor(modelItem => item.AssetCode)');"><span class="glyphicon glyphicon-erase"></span></button>
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                        <div class="ln_solid"></div>
                        <form class="form-horizontal form-label-left">
                            <div class="form-group">
                                <label class="control-label col-md-1 col-sm-1 col-xs-12">Transfer No</label>
                                <div class="col-md-4 col-sm-4 xdisplay_inputx form-group has-feedback">
                                    <input class="form-control" id="TransferNo" name="TransferNo" value="Auto Generate" type="text" data-id="i" autocomplete="off" style="cursor:auto;" required="" readonly />
                                </div>
                                <label class="control-label col-md-1 col-sm-1 col-xs-12">Type</label>
                                <div class="col-md-4 col-sm-4 col-xs-12">
                                    <div class="">
                                        <input class="form-control readonly" id="Type" name="Type" value="" type="hidden" data-id="i" autocomplete="off" required="" />
                                        <input class="form-control readonly" id="TypeName" placeholder="Type" name="TypeName" value="" type="text" data-id="i" autocomplete="off" required="" onclick="TypeTransfer()" data-target="#Lookup" data-toggle="modal" style="cursor:auto; margin-right:0;height: 34px;" readonly />
                                        @*<span class="input-group-btn">
                                            <a class="btn btn-info" onclick="TypeTransfer()" data-target="#Lookup" data-toggle="modal" style="margin-right:0;height: 34px; readonly">
                                                <i class="fa fa-search fa-fw"></i>
                                            </a>
                                        </span>*@
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="control-label col-md-1 col-sm-1 col-xs-12">Transfer Date</label>
                                <div class="col-md-4 col-sm-4 xdisplay_inputx form-group has-feedback">
                                    <input type="text" class="form-control has-feedback-left" id="single_cal2" name="ScheduleDate" placeholder="Schedule Date" data-id="i" aria-describedby="scheduleDate">
                                    <span class="fa fa-calendar-o form-control-feedback left" aria-hidden="true"></span>
                                    <span id="scheduleDate" class="sr-only">(success)</span>
                                </div>
                                <label class="control-label col-md-1 col-sm-1 col-xs-12">Transfer Asset Ref</label>
                                <div class="col-md-4 col-sm-4 col-xs-12">
                                    <div class="">
                                        <input class="form-control readonly" id="TransferAssetNoRef" placeholder="Transfer Asset Ref" name="TransferAssetNoRef" value="" type="text" data-id="i" autocomplete="off" onclick="TransferNoRef()" data-target="#Lookup" data-toggle="modal" style="margin-right:0;height: 34px;cursor:auto;" readonly />
                                        @*<span class="input-group-btn">
                                            <a class="btn btn-info" id="btnRefTransfer" name="btnRefTransfer" onclick="TransferNoRef()" data-target="#Lookup" data-toggle="modal" style="margin-right:0;height: 34px;" readonly>
                                                <i class="fa fa-search fa-fw"></i>
                                            </a>
                                        </span>*@
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="control-label col-md-1 col-sm-1 col-xs-12">Site</label>
                                <div class="col-md-4 col-sm-4 col-xs-12">
                                    <div class="">
                                        <input class="form-control readonly" id="SiteCode" name="SiteCode" value="" type="hidden" data-id="i" autocomplete="off" required="" />
                                        <input class="form-control readonly" placeholder="Site" id="SiteName" name="SiteName" value="" type="text" data-id="i" autocomplete="off" required="" onclick="Site()" data-target="#Lookup" data-toggle="modal" style="curson:auto;margin-right:0;height: 34px; cursor:auto;" readonly />
                                        @*<span class="input-group-btn">
                                            <a class="btn btn-info" style="margin-right:0;height: 34px;">
                                                <i class="fa fa-search fa-fw"></i>
                                            </a>
                                        </span>*@
                                    </div>
                                </div>
                                <label class="control-label col-md-1 col-sm-1 col-xs-12">Location</label>
                                <div class="col-md-4 col-sm-4 col-xs-12">
                                    <div class="">
                                        <input class="form-control readonly" id="LocationCode" name="LocationCode" value="" type="hidden" data-id="i" autocomplete="off" required="" />
                                        <input class="form-control readonly" placeholder="Location" id="LocationName" name="LocationName" value="" type="text" data-id="i" autocomplete="off" required="" onclick="Location()" data-target="#Lookup" data-toggle="modal"  style="cursor:auto;margin-right:0;height: 34px;" readonly />
                                        @*<span class="input-group-btn">
                                            <a class="btn btn-info" onclick="Location()" data-target="#Lookup" data-toggle="modal" style="margin-right:0;height: 34px;">
                                                <i class="fa fa-search fa-fw"></i>
                                            </a>
                                        </span>*@
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="control-label col-md-1 col-sm-1 col-xs-12">Floor</label>
                                <div class="col-md-4 col-sm-4 xdisplay_inputx form-group has-feedback">
                                    <input class="form-control readonly" id="Floor" name="Floor" placeholder="Floor" value="" type="text" data-id="i" autocomplete="off" required="" style="cursor:auto;" readonly />
                                </div>
                                <label class="control-label col-md-1 col-sm-1 col-xs-12">Notes</label>
                                <div class="col-md-4 col-sm-4 col-xs-12">
                                    <textarea id="Notes" name="Notes" class="form-control" rows="3" placeholder="Notes" data-id="i"></textarea>
                                </div>
                            </div>
                            <div class="ln_solid"></div>
                            <div class="form-group">
                                <div class="col-md-6 col-sm-6 col-xs-12 col-md-offset-1">
                                    <button type="button" class="btn btn-success" onclick="Transfer(); return false;">Submit</button>
                                </div>
                            </div>
                        </form>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- MODAL1 START -->
<div class="modal fade" id="addModal" role="dialog" data-keyboard="false" data-backdrop="static">
    <div class="modal-dialog">
        <div class="modal-content col-md-12 col-sm-12 col-xs-12 pdlr1">
            <div class="modal-header">
                <h4 class="modal-title ">Add Asset</h4>
            </div>
            <div class="modal-body col-md-12 col-sm-12 col-xs-12">
                <form class="form-horizontal form-label-left">
                    <div class="form-group">
                        <label class="control-label col-md-3 col-sm-3 col-xs-12">Asset Code</label>
                        <div class="col-md-9 col-sm-9 col-xs-12">
                            <div class="">
                                <input class="form-control readonly" id="AssetCode" placeholder="Asset Code" name="AssetCode" value="" type="text" data-id="i" autocomplete="off" onclick="Asset('1')" data-target="#Lookup" data-toggle="modal" style="cursor:auto;" required="" readonly />
                                @*<span class="input-group-btn">
                                    <a class="btn btn-info"  style="margin-right:0;height: 34px;">
                                        <i class="fa fa-search fa-fw"></i>
                                    </a>
                                </span>*@
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-md-3 col-sm-3 col-xs-12">Asset Name</label>
                        <div class="col-md-9 col-sm-9 col-xs-12">
                            <input id="AssetName" type="text" name="AssetName" class="form-control col-md-10" placeholder="Asset Name" />
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-md-3 col-sm-3 col-xs-12">Serial No</label>
                        <div class="col-md-9 col-sm-9 col-xs-12">
                            <input id="AssetSerialNo" type="text" name="AssetSerialNo" class="form-control col-md-10" placeholder="Serial No" />
                        </div>
                    </div>
                    <div class="ln_solid col-md-12 col-sm-12 col-xs-12"></div>
                    <div class="form-group col-md-12 col-sm-12 col-xs-12 pdlr0">
                        <div class="row col-md-12 col-sm-12 col-xs-12 pdlr0" style="text-align:right;">
                            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                            <button id="AddAssetBtn" type="button" class="btn btn-primary" onclick="AddAsset(); return false;">Add</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
<!-- MODAL1 END -->
@Html.Partial("~/Views/Shared/WarningModal.cshtml")
@RenderPage("~/Views/Shared/_FooterLayout.cshtml")
@Html.Partial("~/Views/Shared/PopupModal.cshtml")

<script type="text/javascript">
    $(document).ready(function () {
        $("#selectasset").click(function () {            
                $("#addModal").modal();
            });
        });
        
        $('#btnRefTransfer').addClass('disabled');

</script>