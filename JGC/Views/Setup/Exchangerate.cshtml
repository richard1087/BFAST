@model CORE.JGC.Models.MsExchangeRate[]
@{
    ViewBag.Title = "Exchangerate";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<script type="text/javascript">

    function Currency(Jenis) {
        var Column = [
                    { "data": "0" },
                    { "title": "Currency Code", "data": "0" },
                    { "title": "Currency Name", "data": "1" }
        ]
        DTable("datatablepopup", '@Url.Action("GetPopupCurrency", "Setup")', Column, '{}');
        $('#datatablepopup tbody').on('click', 'tr', function () {
            var d = table.row(this).data();
            if (Jenis == '1') {
                $("#CurrencyCode").val(d[0]);
                $("#CurrencyName").val(d[1]);
            }
            else if (Jenis == '2') {
                $("#CurrencyConvertCode").val(d[0]);
                $("#CurrencyConvertName").val(d[1]);
            }
            else if (Jenis == '3') {
                $("#EditCurrencyCode").val(d[0]);
                $("#EditCurrencyName").val(d[1]);
            }
            else if (Jenis == '4') {
                $("#EditCurrencyConvertCode").val(d[0]);
                $("#EditCurrencyConvertName").val(d[1]);
            }
            $('#Lookup').modal('hide');
        });
    }

    function InputExchangeRate() {
        var CurrencyCodeId = document.getElementById("CurrencyCode").value;
        var CurrencyConvertCodeId = document.getElementById("CurrencyConvertCode").value;
        var RateId = document.getElementById("RateId").value;

        if (CurrencyCodeId == "") {
            $(".modal-body #peringatan3").text("Currency must be filled");
            $('#btnerror').click(function (e) {
                $('#Alert3').modal('hide');
            })
            $("#Alert3").modal();
        } else if (CurrencyCodeId == CurrencyConvertCodeId) {
            $(".modal-body #peringatan3").text("Currency and Currency Convert must be different");
            $('#btnerror').click(function (e) {
                $('#Alert3').modal('hide');
            })
            $("#Alert3").modal();
        } else if (CurrencyConvertCodeId == "") {
            $(".modal-body #peringatan3").text("Currency Convert must be filled");
            $('#btnerror').click(function (e) {
                $('#Alert3').modal('hide');
            })
            $("#Alert3").modal();
        } else if (RateId == "" || RateId <= 0) {
            $(".modal-body #peringatan3").text("Exchange Rate must be filled");
            $('#btnerror').click(function (e) {
                $('#Alert3').modal('hide');
            })
            $("#Alert3").modal();
        }
        else {
            $.ajax({
                url: '@Url.Action("InsertExchangeRate", "Setup")',
                type: 'post',
                cache: false,
                async: true,
                data: {
                    CurrencyCode: CurrencyCodeId,
                    CurrencyCodeConvert: CurrencyConvertCodeId,
                    ExchangeRate: RateId
                },
                success: function (response) {
                    if (response.success == true) {
                        $(".modal-body #peringatan2").text(response.responseText);
                        $('#btnok').click(function (e) {
                            window.location.href = "@Url.Action("Exchangerate", "Setup")";
                        })
                        $("#Alert2").modal();
                    } else {
                        $(".modal-body #peringatan3").text(response.responseText);
                        $('#btnerror').click(function (e) {
                            $('#Alert3').modal('hide');
                        })
                        $("#Alert3").modal();
                    }
                },
                error: function (XMLHttpRequest, textStatus, errorThrown) {
                    $(".modal-body #peringatan1").text("Please Wait...");
                    $('#btncaution').click(function (e) {
                        $('#Alert1').modal('hide');
                    })
                    $("#Alert1").modal();
                }
            });
        }
    }

    function InputEditExchangeRate() {
        var EditCurrencyCodeId = document.getElementById("EditCurrencyCode").value;
        var EditCurrencyConvertCodeId = document.getElementById("EditCurrencyConvertCode").value;
        var EditRateId = document.getElementById("EditRateId").value;

        if (EditCurrencyCodeId == "") {
            $(".modal-body #peringatan3").text("Currency must be filled");
            $('#btnerror').click(function (e) {
                $('#Alert3').modal('hide');
            })
            $("#Alert3").modal();
        } else if (EditCurrencyConvertCodeId == "") {
            $(".modal-body #peringatan3").text("Currency Convert must be filled");
            $('#btnerror').click(function (e) {
                $('#Alert3').modal('hide');
            })
            $("#Alert3").modal();
        } else if (EditCurrencyCodeId == EditCurrencyConvertCodeId) {
            $(".modal-body #peringatan3").text("Currency and Currency Convert must be different");
            $('#btnerror').click(function (e) {
                $('#Alert3').modal('hide');
            })
            $("#Alert3").modal();
        } else if (EditRateId == "" || EditRateId <= 0) {
            $(".modal-body #peringatan3").text("Exchange Rate must be filled");
            $('#btnerror').click(function (e) {
                $('#Alert3').modal('hide');
            })
            $("#Alert3").modal();
        } else {
            $(".modal-body #peringatan4").text("Are You Sure Update Data: " + EditCurrencyCodeId + ' ( ' + EditCurrencyConvertCodeId + " ) ? ");
            $('#btnyes').click(function (e) {
                $('#Alert4').modal('hide');

                $.ajax({
                    url: '@Url.Action("UpdateExchangeRate", "Setup")',
                    type: 'post',
                    cache: false,
                    async: true,
                    data: {
                        EditCurrencyCode: EditCurrencyCodeId,
                        EditCurrencyCodeConvert: EditCurrencyConvertCodeId,
                        EditExchangeRate: EditRateId
                    },
                    success: function (response) {
                        if (response.success == true) {
                            $(".modal-body #peringatan2").text(response.responseText);
                            $('#btnok').click(function (e) {
                                window.location.href = "@Url.Action("Exchangerate", "Setup")";
                            })
                            $("#Alert2").modal();
                        } else {
                            $(".modal-body #peringatan3").text(response.responseText);
                            $('#btnerror').click(function (e) {
                                $('#Alert3').modal('hide');
                            })
                            $("#Alert3").modal();
                        }
                    },
                    error: function (XMLHttpRequest, textStatus, errorThrown) {
                        $(".modal-body #peringatan1").text("Please Wait...");
                        $('#btncaution').click(function (e) {
                            $('#Alert1').modal('hide');
                        })
                        $("#Alert1").modal();
                    }
                });
            });
            $('#btnno').click(function (e) {
                $('#Alert4').modal('hide');
            });
            $("#Alert4").modal();
        }
    }

    function UpdateExchangeRateS(NoID, CurrencyCode, CurrencyName, CurrencyConvertCode, CurrencyConvertName, RateId) {
        $(".modal-body #EditCurrencyCode").val(CurrencyCode);
        $(".modal-body #EditCurrencyName").val(CurrencyName);

        $(".modal-body #EditCurrencyConvertCode").val(CurrencyConvertCode);
        $(".modal-body #EditCurrencyConvertName").val(CurrencyConvertName);

        $(".modal-body #EditRateId").val(RateId);

        $(".modal-body #NoID").val(NoID);

        $("#editModal").modal();
    }

    function CancelData(jenis) {
        if (jenis == '1') {
            $(".modal-body #CurrencyCode").val('');
            $(".modal-body #CurrencyCode").val('');

            $(".modal-body #CurrencyConvertCode").val('');
            $(".modal-body #CurrencyConvertCode").val('');

            $(".modal-body #RateId").val('0');
        }
        else {
            $(".modal-body #EditCurrencyCode").val('');
            $(".modal-body #EditCurrencyCode").val('');

            $(".modal-body #EditCurrencyConvertCode").val('');
            $(".modal-body #EditCurrencyConvertCode").val('');

            $(".modal-body #EditRateId").val('0');
        }
    }

</script>

<div class="right_col" role="main">
    <div class="">
        <div class="row">
            <div class="col-md-12 col-sm-12 col-xs-12">
                <div class="x_panel">
                    <div class="menusect">
                        <h5>
                            Setup •
                            <a href="/setup/exchangerate" class="activemenu">Exchange Rate</a>
                        </h5>
                    </div>
                    <div class="x_title">
                        <h2>List of Exchange Rates</h2>
                        <div class="clearfix"></div>
                    </div>
                    <div class="x_content">

                        <div class="col-md-12 col-sm-12 col-xs-12 text-muted font-13 m-b-30 no-padding">
                            <div class="mgbtm20">
                                <a href="#" id="tambahrate" class="btn btn-success btn-cust">Add New Exchange Rate</a>
                            </div>
                        </div>
                        <table id="datatable" class="table table-striped table-bordered bulk_action">
                            <thead>
                                <tr>
                                    <th style="width:9% !important;">@Html.Label("Currency Code")</th>
                                    <th style="width:12% !important;">@Html.Label("Currency Name")</th>
                                    <th style="width:9% !important;">@Html.Label("Currency Code Convert")</th>
                                    <th style="width:12% !important;">@Html.Label("Currency Name Convert")</th>
                                    <th style="width:9% !important;">@Html.Label("Exchange Rate")</th>
                                    <th style="width:9%;"></th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach(var item in Model)
                                { 
                                <tr>
                                    <td>@Html.DisplayFor(modelItem => item.CurrencyCode)</td>
                                    <td>@Html.DisplayFor(modelItem => item.CurrencyName)</td>
                                    <td>@Html.DisplayFor(modelItem => item.CurrencyCodeConvert)</td>
                                    <td>@Html.DisplayFor(modelItem => item.CurrencyNameConvert)</td>
                                    <td>@Html.DisplayFor(modelItem => item.ExchangeRate)</td>
                                    <td style="width:5% !important;text-align:center;">
                                        <button id="editlocationbutton" name="editlocationbutton" type="button" class="btn btn-success" onclick="UpdateExchangeRateS('@Html.DisplayFor(modelItem => item.Id)','@Html.DisplayFor(modelItem => item.CurrencyCode)','@Html.DisplayFor(modelItem => item.CurrencyName)','@Html.DisplayFor(modelItem => item.CurrencyCodeConvert)','@Html.DisplayFor(modelItem => item.CurrencyNameConvert)','@Html.DisplayFor(modelItem => item.ExchangeRate)')"><span class="glyphicon glyphicon-edit"></span>&nbsp;</button>
                                    </td>
                                </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- MODAL1 START -->
<div class="modal fade" id="addModal" role="dialog" data-keyboard="false" data-backdrop="static">
    <div class="modal-dialog">
        <div class="modal-content col-md-12 col-sm-12 col-xs-12 pdlr1">
            <div class="modal-header">
                <h4 class="modal-title ">Add a Exchange Rate</h4>
            </div>
            <div class="modal-body col-md-12 col-sm-12 col-xs-12">

                <form class="form-horizontal form-label-left">

                    <!--<div class="form-group mgb25">
                        <label class="control-label col-md-12 col-sm-12 col-xs-12">
                            Add departments that own or house the particular assets. Make them as broad or as specific as you want.
                            Departments can be 'Accounting', 'Marketing', or 'Executive'. Customize to your particular need.
                        </label>
                    </div>-->

                    <div class="form-group">
                        <label class="control-label col-md-3 col-sm-3 col-xs-12">Currency</label>
                        <div class="col-md-9 col-sm-9 col-xs-12">
                            <div class="input-group">
                                <input class="form-control readonly" id="CurrencyCode" name="CurrencyCode" value="" type="hidden" data-id="i" autocomplete="off" required="" />
                                <input class="form-control readonly" id="CurrencyName" name="CurrencyName" value="" type="text" data-id="i" autocomplete="off" required="" readonly />
                                <span class="input-group-btn">
                                    <a class="btn btn-info" onclick="Currency('1')" data-target="#Lookup" data-toggle="modal" style="margin-right:0;height: 34px;">
                                        <i class="fa fa-search fa-fw"></i>
                                    </a>
                                </span>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="control-label col-md-3 col-sm-3 col-xs-12">Currency Convert</label>
                        <div class="col-md-9 col-sm-9 col-xs-12">
                            <div class="input-group">
                                <input class="form-control readonly" id="CurrencyConvertCode" name="CurrencyConvertCode" value="" type="hidden" data-id="i" autocomplete="off" required="" />
                                <input class="form-control readonly" id="CurrencyConvertName" name="CurrencyConvertName" value="" type="text" data-id="i" autocomplete="off" required="" readonly />
                                <span class="input-group-btn">
                                    <a class="btn btn-info" onclick="Currency('2')" data-target="#Lookup" data-toggle="modal" style="margin-right:0;height: 34px;">
                                        <i class="fa fa-search fa-fw"></i>
                                    </a>
                                </span>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="control-label col-md-3 col-sm-3 col-xs-12">Exchange Rate</label>
                        <div class="col-md-9 col-sm-9 col-xs-12">
                            <input id="RateId" type="number" name="RateId" class="form-control col-md-10" placeholder="Exchange Rate" />
                        </div>
                    </div>

                    <div class="ln_solid col-md-12 col-sm-12 col-xs-12"></div>
                    <div class="form-group col-md-12 col-sm-12 col-xs-12 pdlr0">
                        <div class="row col-md-12 col-sm-12 col-xs-12 pdlr0" style="text-align:right;">
                            <button id="RateAddId" type="button" class="btn btn-primary" onclick="InputExchangeRate(); return false;">Add</button>
                            <button id="RateCancelId" type="button" class="btn btn-default">Cancel</button>
                        </div>
                    </div>

                </form>

            </div>
        </div>
    </div>
</div>
<!-- MODAL1 END -->

<!-- MODAL2 START -->
<div class="modal fade" id="editModal" role="dialog" data-keyboard="false" data-backdrop="static">
    <div class="modal-dialog">
        <div class="modal-content col-md-12 col-sm-12 col-xs-12 pdlr1">
            <div class="modal-header">
                <h4 class="modal-title ">Edit Exchange Rate</h4>
            </div>
            <div class="modal-body col-md-12 col-sm-12 col-xs-12">

                <form class="form-horizontal form-label-left">
                    <div class="form-group">
                        <label class="control-label col-md-3 col-sm-3 col-xs-12">Currency</label>
                        <div class="col-md-9 col-sm-9 col-xs-12">
                            <div class="input-group">
                                <input id="NoId" type="hidden" name="NoId" value="" />
                                <input class="form-control readonly" id="EditCurrencyCode" name="EditCurrencyCode" value="" type="hidden" data-id="i" autocomplete="off" required="" />
                                <input class="form-control readonly" id="EditCurrencyName" name="EditCurrencyName" value="" type="text" data-id="i" autocomplete="off" required="" readonly />
                                <span class="input-group-btn">
                                    <a class="btn btn-info" onclick="Currency('3')" data-target="#Lookup" data-toggle="modal" style="margin-right:0;height: 34px;">
                                        <i class="fa fa-search fa-fw"></i>
                                    </a>
                                </span>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="control-label col-md-3 col-sm-3 col-xs-12">Currency Convert</label>
                        <div class="col-md-9 col-sm-9 col-xs-12">
                            <div class="input-group">
                                <input class="form-control readonly" id="EditCurrencyConvertCode" name="EditCurrencyConvertCode" value="" type="hidden" data-id="i" autocomplete="off" required="" />
                                <input class="form-control readonly" id="EditCurrencyConvertName" name="EditCurrencyConvertName" value="" type="text" data-id="i" autocomplete="off" required="" readonly />
                                <span class="input-group-btn">
                                    <a class="btn btn-info" onclick="Currency('4')" data-target="#Lookup" data-toggle="modal" style="margin-right:0;height: 34px;">
                                        <i class="fa fa-search fa-fw"></i>
                                    </a>
                                </span>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="control-label col-md-3 col-sm-3 col-xs-12">Exchange Rate</label>
                        <div class="col-md-9 col-sm-9 col-xs-12">
                            <input type="number" id="EditRateId" name="EditRateId" class="form-control col-md-10" value="500" placeholder="Exchange Rate" />
                        </div>
                    </div>

                    <div class="ln_solid col-md-12 col-sm-12 col-xs-12"></div>
                    <div class="form-group col-md-12 col-sm-12 col-xs-12 pdlr0">
                        <div class="row col-md-12 col-sm-12 col-xs-12 pdlr0" style="text-align:right;">
                            <button id="EditRateIdButton" type="button" class="btn btn-primary" onclick="InputEditExchangeRate(); return false;">Edit</button>
                            <button id="CancelRateIdButton" type="button" class="btn btn-default">Cancel</button>
                        </div>
                    </div>

                </form>

            </div>
        </div>
    </div>
</div>
<!-- MODAL2 END -->
@Html.Partial("~/Views/Shared/PopupModal.cshtml")
@Html.Partial("~/Views/Shared/WarningModal.cshtml")
@RenderPage("~/Views/Shared/_FooterLayout.cshtml")

<script type="text/javascript">
      $(document).ready(function(){
          $("#tambahrate").click(function () {
              $("#addModal").modal();
          });
          //$("#RateAddId").click(function () {
          //    $("#addModal").modal('toggle');
          //});
          $("#RateCancelId").click(function () {
              CancelData('1');
              $("#addModal").modal('toggle');
          });

          $("#editrate").click(function () {
              $("#editModal").modal();
          });
          //$("#EditRateIdButton").click(function () {
          //    $("#editModal").modal('toggle');
          //});
          $("#CancelRateIdButton").click(function () {
              CancelData('2');
              $("#editModal").modal('toggle');
          });
      });

      $("#check-all").click(function () {
          $(".checks").prop('checked', $(this).prop('checked'));
      });

</script>
